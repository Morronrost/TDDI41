#!/usr/sbin/nft -f

flush ruleset

table inet filter {
	chain inbound {
		#by default drop all trafic unless it meets filter criteria
		type filter hook input priority 0; policy drop;

		#allow traffic from established and related packets, drops invalid
		ct state vmap { established: accept, related: accept, invalid: drop }

		#accepts loopback traffic
		iifname lo accept

		#allow SSH on port TCP/22 and dns on UDP/53
		tcp dport { 22 } accept
		udp dport { 53 } accept

		#accept ping requests
		icmp type echo-request accept

		#accepts neighbor discovery or connectivity breakes
		icmpv6 type { nd-neighbor-solicit, nd-router-advert, nd-neighbor-advert } accept
	}
}

table ip nat {
	chain prerouting {
		type nat hook prerouting priority dstnat; policy accept;
	}

	chain postrouting {
		type nat hook postrouting priority -100; policy accept;
		oifname "ens3" masquerade
	}

}
